<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Dado Metacognitivo Editable</title>
  <style>
    body {
      background: #e6ecf5;
      color: #123;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    h1 {
      color: #1d3557;
      margin-top: 32px;
      margin-bottom: 16px;
      font-size: 2em;
    }
    .scene {
      width: 330px;
      height: 330px;
      perspective: 1000px;
      margin: 35px auto 24px auto;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .cube {
      width: 180px;
      height: 180px;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.8s cubic-bezier(.25,.8,.25,1);
      margin: 0 auto;
      cursor: pointer;
      user-select: none;
    }
    .face {
      position: absolute;
      width: 180px;
      height: 180px;
      background: #fff;
      border-radius: 22px;
      box-shadow: 0 4px 22px #0002;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.13em;
      font-weight: 600;
      text-align: center;
      padding: 22px 15px 22px 15px;
      color: #124;
      transition: background 0.3s;
      word-break: break-word;
    }
    .f1 { transform: rotateY(0deg)   translateZ(90px); background: #93e2ff;}
    .f2 { transform: rotateY(90deg)  translateZ(90px); background: #f7b6aa;}
    .f3 { transform: rotateY(180deg) translateZ(90px); background: #ffe16b;}
    .f4 { transform: rotateY(-90deg) translateZ(90px); background: #b7f7c2;}
    .f5 { transform: rotateX(90deg)  translateZ(90px); background: #d3b6f7;}
    .f6 { transform: rotateX(-90deg) translateZ(90px); background: #ffd6e0;}
    .cube:active { box-shadow: 0 2px 24px #0077b660;}
    .face .del-btn {
      background: #ffb0b0;
      color: #910b0b;
      border: none;
      border-radius: 7px;
      font-size: 1em;
      font-weight: bold;
      cursor: pointer;
      padding: 2px 9px;
      margin-left: 7px;
      margin-top: -9px;
      float: right;
      transition: background 0.2s;
    }
    .face .del-btn:hover { background: #e55;}
    #editBtn {
      margin: 0 auto 18px auto;
      padding: 14px 32px;
      font-size: 1.15em;
      font-weight: bold;
      color: #fff;
      background: #0077b6;
      border: none;
      border-radius: 28px;
      cursor: pointer;
      transition: background 0.2s;
      box-shadow: 0 2px 12px #0077b64a;
      display: block;
    }
    #editBtn:hover { background: #005a8d;}
    .editor {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 2px 16px #0002;
      padding: 18px 22px 12px 22px;
      margin-bottom: 28px;
      max-width: 410px;
      width: 100%;
      display: none;
      flex-direction: column;
      gap: 10px;
      z-index: 10;
      position: relative;
    }
    .editor.active { display: flex; }
    .editor label { font-size: 1em; font-weight: 600; margin-bottom: 3px;}
    .editor input[type="text"] {
      width: 89%;
      font-size: 1em;
      padding: 4px 8px;
      border-radius: 7px;
      border: 1px solid #b6e7f7;
      margin-bottom: 3px;
      background: #f6fcff;
      color: #222;
    }
    .editor .row {
      display: flex;
      align-items: center;
      margin-bottom: 4px;
      gap: 4px;
    }
    .editor button {
      margin-left: 4px;
      background: #ffb0b0;
      border: none;
      border-radius: 7px;
      color: #910b0b;
      font-weight: bold;
      cursor: pointer;
      padding: 3px 8px;
      font-size: 1em;
      transition: background 0.2s;
    }
    .editor button.edit { background: #b6e7f7; color: #06577a;}
    .editor button.save { background: #b7f7c2; color: #0e5c29;}
    .editor .add-btn {
      background: #b7f7c2;
      color: #157d3d;
      font-size: 1.08em;
      padding: 4px 14px;
      border-radius: 11px;
      font-weight: 700;
      margin-top: 8px;
      margin-bottom: 2px;
      border: none;
      cursor: pointer;
    }
    .editor .add-btn:hover { background: #a2e5af;}
    .editor .close-btn {
      background: #e3e3e3;
      color: #444;
      float: right;
      border-radius: 9px;
      padding: 2px 12px;
      margin-bottom: 5px;
      border: none;
      font-size: 1.02em;
      font-weight: 600;
      cursor: pointer;
    }
    @media (max-width:600px) {
      h1 { font-size: 1.3em; }
      .scene { width: 99vw; height: 72vw; min-width: 170px; }
      .face { font-size: 0.97em; padding: 9px 2px;}
      .editor { max-width: 99vw; }
      .cube { width: 120px; height: 120px;}
      .face { width: 120px; height: 120px;}
      .f1, .f2, .f3, .f4, .f5, .f6 { transform: none !important; }
    }
  </style>
</head>
<body>
  <h1>Dado Metacognitivo Editable</h1>
  <div class="scene">
    <div class="cube" id="cube">
      <!-- Caras generadas por JS -->
    </div>
  </div>
  <button id="editBtn">Editar preguntas</button>
  <div class="editor" id="editorPanel">
    <button class="close-btn" id="closeEditorBtn">Cerrar âœ•</button>
    <div id="questionsList"></div>
    <input type="text" id="newQuestion" placeholder="Nueva pregunta...">
    <button class="add-btn" id="addQuestionBtn">Agregar pregunta</button>
  </div>
  <script>
    // Preguntas por default (dado de 6 caras)
    let preguntas = [
      "ğŸ’¡ Algo que entendÃ­ mejor hoy fue...",
      "âš™ï¸ Una vez que me equivoquÃ© y aprendÃ­ fue cuando...",
      "ğŸ¤ Â¿QuÃ© hice para ayudar a otro a aprender?",
      "ğŸ—ºï¸ Â¿QuÃ© estrategia usÃ© hoy que me funcionÃ³ muy bien?",
      "ğŸ” Â¿QuÃ© nueva pregunta me surgiÃ³ a partir de lo que aprendÃ­?",
      "â¤ï¸ Â¿CÃ³mo me sentÃ­ mientras aprendÃ­a esto?"
    ];

    // Banco de preguntas extra
    const preguntasEjemplo = [
      "ğŸ”— Â¿QuÃ© conecta esto con otro saber?",
      "ğŸ§  Â¿CÃ³mo cambiarÃ­a mi opiniÃ³n sobre esto?",
      "ğŸ“š Â¿DÃ³nde podrÃ­a aprender mÃ¡s sobre esto?",
      "ğŸŒ± Â¿QuÃ© me gustarÃ­a explorar la prÃ³xima vez?",
      "ğŸ¯ Â¿QuÃ© objetivo cumplÃ­ hoy?",
      "ğŸ˜ƒ Â¿QuÃ© disfrutÃ© mÃ¡s del aprendizaje?",
      "ğŸš€ Â¿QuÃ© me desafiÃ³ hoy?",
      "ğŸ’¬ Â¿CÃ³mo explicarÃ­a esto a un amigo?"
    ];

    // Para evitar repeticiones:
    let preguntasRestantes = [];

    // Colores por cara
    const carasColor = [
      "#93e2ff", "#f7b6aa", "#ffe16b", "#b7f7c2", "#d3b6f7", "#ffd6e0"
    ];

    // Rotaciones para cada cara al frente
    const rotaciones = [
      {x: 0,    y: 0},      // 1: frente
      {x: 0,    y: -90},    // 2: derecha
      {x: 0,    y: -180},   // 3: atrÃ¡s
      {x: 0,    y: 90},     // 4: izquierda
      {x: -90,  y: 0},      // 5: arriba
      {x: 90,   y: 0}       // 6: abajo
    ];

    function renderCube() {
      const cube = document.getElementById('cube');
      cube.innerHTML = '';
      for(let i=0;i<6;i++) {
        let face = document.createElement('div');
        face.className = 'face f'+(i+1);
        face.style.background = carasColor[i % carasColor.length];
        face.innerHTML = `<span>${preguntas[i]}</span>
          <button class="del-btn" onclick="removeQuestion(${i});event.stopPropagation();" title="Borrar">ğŸ—‘</button>`;
        cube.appendChild(face);
      }
    }

    // RotaciÃ³n interactiva con el mouse
    let dragging = false, lastX, lastY, rotX = -20, rotY = -30;
    const cube = document.getElementById('cube');
    function updateRotation() {
      cube.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)`;
    }
    updateRotation();
    cube.parentElement.addEventListener('mousedown', (e) => {
      dragging = true; lastX = e.clientX; lastY = e.clientY;
    });
    window.addEventListener('mousemove', (e) => {
      if (!dragging) return;
      rotY += (e.clientX - lastX) * 0.9;
      rotX -= (e.clientY - lastY) * 0.9;
      if(rotX > 90) rotX = 90; if(rotX < -90) rotX = -90;
      updateRotation();
      lastX = e.clientX; lastY = e.clientY;
    });
    window.addEventListener('mouseup', ()=>{ dragging = false; });

    // Inicializar preguntasRestantes (evita repetidos)
    function resetPreguntasRestantes() {
      preguntasRestantes = preguntasEjemplo.filter(q => !preguntas.includes(q));
    }

    // Rotar dado a cara random y agregar una nueva pregunta random NO repetida hasta agotar
    cube.onclick = function(e) {
      if (preguntas.length < 6) return; // No agregar si hay menos de 6

      // Inicializa/restablece si estÃ¡n agotadas
      if (preguntasRestantes.length === 0) {
        resetPreguntasRestantes();
      }

      let nueva;
      if (preguntas.length < 20) {
        if (preguntasRestantes.length) {
          // Elige una random de las que faltan
          let idx = Math.floor(Math.random()*preguntasRestantes.length);
          nueva = preguntasRestantes.splice(idx,1)[0];
        } else {
          nueva = "Nueva pregunta";
        }
        preguntas.push(nueva);
        if (carasColor.length < preguntas.length) {
          carasColor.push("#e3e3e3");
        }
        renderCube();
        renderQuestionsEditor();
      }
      // Rotar a una cara random
      let cara = Math.floor(Math.random() * Math.min(6, preguntas.length));
      rotX = rotaciones[cara].x;
      rotY = rotaciones[cara].y;
      updateRotation();
    };

    // Eliminar pregunta (caracterÃ­stica expuesta en cara y editor)
    window.removeQuestion = function(idx) {
      if (preguntas.length <= 1) return;
      preguntas.splice(idx,1);
      resetPreguntasRestantes();
      renderCube();
      renderQuestionsEditor();
      updateRotation();
    }

    // Editor de preguntas
    const editBtn = document.getElementById('editBtn');
    const editorPanel = document.getElementById('editorPanel');
    const questionsList = document.getElementById('questionsList');
    const newQuestion = document.getElementById('newQuestion');
    const addQuestionBtn = document.getElementById('addQuestionBtn');
    const closeEditorBtn = document.getElementById('closeEditorBtn');

    function renderQuestionsEditor() {
      questionsList.innerHTML = '';
      preguntas.forEach((q, i) => {
        let row = document.createElement('div');
        row.className = 'row';
        let inp = document.createElement('input');
        inp.type = "text";
        inp.value = q;
        inp.disabled = true;
        inp.id = "editq" + i;
        row.appendChild(inp);
        let editB = document.createElement('button');
        editB.textContent = "âœ";
        editB.className = "edit";
        editB.onclick = () => {
          inp.disabled = false;
          inp.focus();
          editB.style.display = "none";
          saveB.style.display = "inline-block";
        };
        row.appendChild(editB);
        let saveB = document.createElement('button');
        saveB.textContent = "ğŸ’¾";
        saveB.className = "save";
        saveB.style.display = "none";
        saveB.onclick = () => {
          preguntas[i] = inp.value;
          inp.disabled = true;
          editB.style.display = "inline-block";
          saveB.style.display = "none";
          resetPreguntasRestantes();
          renderCube();
        };
        row.appendChild(saveB);
        let delB = document.createElement('button');
        delB.textContent = "ğŸ—‘";
        delB.onclick = () => {
          if(preguntas.length <= 1) return;
          preguntas.splice(i,1);
          resetPreguntasRestantes();
          renderQuestionsEditor();
          renderCube();
        };
        row.appendChild(delB);
        questionsList.appendChild(row);
      });
    }

    editBtn.onclick = () => {
      renderQuestionsEditor();
      editorPanel.classList.add('active');
    };
    closeEditorBtn.onclick = () => {
      editorPanel.classList.remove('active');
    };
    addQuestionBtn.onclick = () => {
      let val = newQuestion.value.trim();
      if(val && !preguntas.includes(val)) {
        preguntas.push(val);
        if (carasColor.length < preguntas.length) carasColor.push("#e3e3e3");
        newQuestion.value = "";
        resetPreguntasRestantes();
        renderQuestionsEditor();
        renderCube();
      }
    };

    // Inicial
    resetPreguntasRestantes();
    renderCube();
  </script>
</body>
</html>
